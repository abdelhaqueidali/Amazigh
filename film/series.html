<!DOCTYPE html>
<html>
<head>
<title>YouTube Movie Site</title>
<style>
body {
  font-family: sans-serif;
  margin: 0;
  background-color: #121212;
  color: #fff;
  display: flex;
  min-height: 100vh;
}

.sidebar {
  width: 250px;
  background-color: #212121;
  padding: 20px;
  box-sizing: border-box;
  overflow-y: auto;
  height: 100vh;
}

.sidebar h1 {
  margin-top: 0;
  color: #ddd;
}

.series-title {
  cursor: pointer;
  padding: 5px 0;
  border-bottom: 1px solid #333;
  margin-bottom: 10px;
  font-weight: bold;
}

.episode-list {
  display: none;
  padding-left: 20px;
}

.episode-list li {
  margin-bottom: 5px;
}

.main-content {
  flex-grow: 1;
  padding: 20px;
  box-sizing: border-box;
  display: flex;
  justify-content: center;
  align-items: center;
}

.video-container {
  width: 854px;
  height: 480px;
  max-width: 100%;
  max-height: 80vh;
}

.video-container iframe {
  width: 100%;
  height: 100%;
  border: none;
}

a {
  color: #90caf9;
  text-decoration: none;
}

a:hover {
  text-decoration: underline;
}

</style>
</head>
<body>

<div class="sidebar">
  <h1>YouTube Videos</h1>
  <div id="series-list">
    <!-- Series list will be loaded here -->
  </div>
</div>

<div class="main-content">
  <div id="player" class="video-container">
    <div>Select a video to play.</div>
  </div>
</div>

<script>
function loadAndDisplayData() {
  fetch('data.txt')
    .then(response => response.text())
    .then(data => {
      const lines = data.split('\n');
      let currentSection = null;
      let seriesListHTML = '';
      let currentSeriesEpisodes = [];
      let singleVideoUrl = null;  // Store single video URL


      for (const line of lines) {
        const trimmedLine = line.trim();

        if (!trimmedLine) continue;

        if (trimmedLine.startsWith('[')) {
          // Close previous series, if any
          if (currentSection) {
            seriesListHTML += createSeriesHTML(currentSection, currentSeriesEpisodes);
            currentSeriesEpisodes = []; // Reset
          }
          currentSection = trimmedLine.slice(1, -1);

        }
        else if (trimmedLine.startsWith('Episode')) {
          const [episodeInfo, url] = trimmedLine.split('|');
          const episodeNumber = episodeInfo.trim();
          const videoUrl = url.trim();
          const videoId = extractVideoId(videoUrl);
          if (videoId) {
              currentSeriesEpisodes.push({ number: episodeNumber, id: videoId });
          } else {
              console.warn("Invalid Video URL:", videoUrl);
          }
        }
        else if (trimmedLine.startsWith('https://www.youtube.com')) {
            singleVideoUrl = trimmedLine;

        }
        else {
          console.warn("Skipping line:", trimmedLine);
        }
      }

      // Close the last series
      if (currentSection) {
        if (singleVideoUrl) {
          seriesListHTML += createSingleVideoHTML("Single Video", extractVideoId(singleVideoUrl));  // Create single video entry

        }
        seriesListHTML += createSeriesHTML(currentSection, currentSeriesEpisodes);
      } else if (singleVideoUrl) {
           seriesListHTML += createSingleVideoHTML("Single Video", extractVideoId(singleVideoUrl));  // Create single video entry if there's no section

      }

      document.getElementById('series-list').innerHTML = seriesListHTML;

      // Add event listeners for collapsing/expanding series
      const seriesTitles = document.querySelectorAll('.series-title');
      seriesTitles.forEach(title => {
        title.addEventListener('click', function() {
          const episodeList = this.nextElementSibling;
          episodeList.style.display = episodeList.style.display === 'none' ? 'block' : 'none';
        });
      });

    })
    .catch(error => {
      console.error('Error loading data.txt:', error);
      document.getElementById('series-list').innerHTML = '<p>Error loading data. Please make sure data.txt exists and is in the same directory.</p>';
    });
}


function extractVideoId(url) {
    try {
        const urlObject = new URL(url);
        const videoId = urlObject.searchParams.get('v');
        return videoId;
    } catch (e) {
        return null;
    }
}

function playVideo(videoId) {
    const playerDiv = document.getElementById('player');
    playerDiv.innerHTML = `<iframe src="https://www.youtube.com/embed/${videoId}" frameborder="0" allowfullscreen></iframe>`;
}

function createSeriesHTML(seriesTitle, episodes) {
  let episodeListHTML = '';
  episodes.forEach(episode => {
    episodeListHTML += `<li><a href="#" onclick="playVideo('${episode.id}'); return false;">${episode.number}</a></li>`;
  });

  return `
    <div class="series">
      <div class="series-title">${seriesTitle}</div>
      <ul class="episode-list">${episodeListHTML}</ul>
    </div>
  `;
}
function createSingleVideoHTML(title, videoId) {
  return `
  <div class="series">
      <div class="series-title" onclick="playVideo('${videoId}')">${title}</div>
    </div>
  `;
}

window.onload = loadAndDisplayData;
</script>

</body>
</html>
